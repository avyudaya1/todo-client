(this["webpackJsonptodo-client"]=this["webpackJsonptodo-client"]||[]).push([[0],{222:function(e,t,n){},234:function(e,t,n){"use strict";n.r(t);var r=n(83),a=n.n(r),o=n(0),s=n(65),c=n(18),i=n(250),l=(n(221),n(222),n(25)),d=n(43),j=n(199),u=n(7),b={user:null};if(localStorage.getItem("jwtToken")){var m=Object(j.a)(localStorage.getItem("jwtToken"));1e3*m.exp<Date.now()?localStorage.removeItem("jwtToken"):b.user=m}var O=Object(o.createContext)({user:null,login:function(e){},logout:function(){}});function g(e,t){switch(t.type){case"LOGIN":return Object(d.a)(Object(d.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(d.a)(Object(d.a)({},e),{},{user:null});default:return e}}function h(e){var t=Object(o.useReducer)(g,b),n=Object(l.a)(t,2),r=n[0],a=n[1];return Object(u.jsx)(O.Provider,Object(d.a)({value:{user:r.user,login:function(e){localStorage.setItem("jwtToken",e.token),a({type:"LOGIN",payload:e})},logout:function(){localStorage.removeItem("jwtToken"),a({type:"LOGOUT"})}}},e))}var p=n(208);var x=function(e){var t=e.component,n=Object(p.a)(e,["component"]),r=Object(o.useContext)(O).user;return Object(u.jsx)(c.b,Object(d.a)(Object(d.a)({},n),{},{render:function(e){return r?Object(u.jsx)(c.a,{to:"/"}):Object(u.jsx)(t,Object(d.a)({},e))}}))},v=n(254),f=n(113);var y,w=function(){var e=Object(o.useContext)(O),t=e.user,n=e.logout,r=window.location.pathname,a="/"===r?"home":r.substr(1),c=Object(o.useState)(a),i=Object(l.a)(c,2),d=i[0],j=i[1],b=function(e,t){var n=t.name;return j(n)};return t?Object(u.jsxs)(v.a,{pointing:!0,secondary:!0,size:"massive",color:"red",children:[Object(u.jsx)(f.a,{name:"sticky note",color:"red",size:"big",style:{margin:10,marginRight:0}}),Object(u.jsx)(v.a.Item,{name:"TODO",onClick:b,as:s.b,to:"/"}),Object(u.jsx)(v.a.Item,{name:t.username,active:!0,as:s.b,to:"/"}),Object(u.jsx)(v.a.Menu,{position:"right",children:Object(u.jsx)(v.a.Item,{name:"logout",onClick:n})})]}):Object(u.jsxs)(v.a,{pointing:!0,secondary:!0,size:"massive",color:"red",children:[Object(u.jsx)(f.a,{name:"sticky note",color:"red",size:"big",style:{margin:10,marginRight:0}}),Object(u.jsx)(v.a.Item,{name:"TODO",onClick:b,as:s.b,to:"/"}),Object(u.jsx)(v.a.Item,{name:"login",active:"login"===d,onClick:b,as:s.b,to:"/login"}),Object(u.jsx)(v.a.Item,{name:"register",active:"register"===d,onClick:b,as:s.b,to:"/register"})]})},C=n(31),I=n(260),k=n(251),T=n(255),S=n(48),$=n(30),L=Object($.a)(y||(y=Object(S.a)(["\n    {\n        getTodos{\n            id\n            body\n            isCompleted\n            username\n            createdAt\n        }\n    }\n"]))),P=n(257),Q=n(258),N=n(256),E=n(252);var A,R=function(e){var t=e.content,n=e.children;return Object(u.jsx)(E.a,{inverted:!0,content:t,trigger:n})};var z,D=Object($.a)(A||(A=Object(S.a)(["\n  mutation deleteTodo($todoId: ID!) {\n    deleteTodo(todoId: $todoId)\n  }\n"]))),M=function(e){var t=e.todoId,n=e.callback,r=Object(o.useState)(!1),a=Object(l.a)(r,2),s=a[0],c=a[1],d=Object(C.useMutation)(D,{update:function(e){c(!1);var r=e.readQuery({query:L}).getTodos.filter((function(e){return e.id!==t}));e.writeQuery({query:L,data:{getTodos:r}}),n&&n()},variables:{todoId:t}}),j=Object(l.a)(d,1)[0];return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(R,{content:"Delete todo?",children:Object(u.jsx)(i.a,{children:Object(u.jsx)(Q.a,{circular:!0,size:"tiny",color:"red",icon:"delete",floated:"right",onClick:function(){return c(!0)}})})}),Object(u.jsx)(N.a,{open:s,onCancel:function(){return c(!1)},onConfirm:j})]})};var q=Object($.a)(z||(z=Object(S.a)(["\n  mutation toggleTodoMutation($todoId: ID!) {\n    toggleTodoStatus(todoId: $todoId) {\n      id\n      username\n      body\n      createdAt\n      isCompleted\n    }\n  }\n"]))),U=function(e){var t=e.todoId,n=e.isCompleted,r=e.callback,a=q,o=n,s=Object(C.useMutation)(a,{update:function(e){var t=e.readQuery({query:L}).getTodos;e.writeQuery({query:L,data:{getTodos:t}}),r&&r()},variables:{todoId:t}}),c=Object(l.a)(s,1)[0];return Object(u.jsx)(Q.a,{circular:!0,size:"medium",icon:o?"check":"circle outline",color:o?"green":"grey",floated:"left",onClick:function(){return c()},style:{marginRight:20,display:"flex",justifyContent:"center",alignItems:"center"}})};var G,B=function(e){var t=e.todo,n=t.body,r=t.id,a=(t.createdAt,t.username),s=t.isCompleted,c=Object(o.useContext)(O).user;return Object(u.jsx)(P.a,{fluid:!0,children:Object(u.jsxs)(P.a.Content,{children:[c&&c.username===a&&Object(u.jsx)(M,{todoId:r}),c&&c.username===a&&Object(u.jsx)(U,{todoId:r,isCompleted:s}),Object(u.jsx)(P.a.Header,{children:n})]})})},F=n(206),H=n(253),J=n(132),V=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(o.useState)(t),r=Object(l.a)(n,2),a=r[0],s=r[1],c=function(e){s(Object(d.a)(Object(d.a)({},a),{},Object(J.a)({},e.target.name,e.target.value)))},i=function(t){t.preventDefault(),e()};return{onChange:c,onSubmit:i,values:a}};var W=Object($.a)(G||(G=Object(S.a)(["\n  mutation createTodo($body: String!) {\n    createTodo(body: $body) {\n      id\n      body\n      createdAt\n      username\n      isCompleted\n    }\n  }\n"]))),K=function(){var e=V((function(){s()}),{body:""}),t=e.values,n=e.onChange,r=e.onSubmit,a=Object(C.useMutation)(W,{variables:t,update:function(e,n){var r=e.readQuery({query:L}),a=[n.data.createTodo].concat(Object(F.a)(r.getTodos));e.writeQuery({query:L,data:{getTodos:a}}),t.body=""}}),o=Object(l.a)(a,2),s=o[0],c=o[1].error;return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)(H.a,{onSubmit:r,children:[Object(u.jsx)("h2",{children:"Create a todo:"}),Object(u.jsxs)(H.a.Field,{children:[Object(u.jsx)(H.a.Input,{placeholder:"Water plants.",name:"body",onChange:n,value:t.body,error:!!c}),Object(u.jsx)(Q.a,{type:"submit",color:"red",children:"Submit"})]})]}),c&&Object(u.jsx)("div",{className:"ui error message",style:{marginBottom:20},children:Object(u.jsx)("ul",{className:"list",children:Object(u.jsx)("li",{children:c.graphQLErrors[0]&&c.graphQLErrors[0].message})})})]})};var X,Y=function(){var e=Object(o.useContext)(O).user,t=Object(C.useQuery)(L),n=t.loading,r=t.data,a=(r=void 0===r?{}:r).getTodos;return Object(u.jsx)(i.a,{children:e?Object(u.jsxs)(i.a,{children:[Object(u.jsx)(I.a.Row,{children:Object(u.jsx)(K,{})}),Object(u.jsx)(k.a,{}),n?Object(u.jsx)("h1",{children:"Loading Todos..."}):Object(u.jsx)(T.a.Group,{children:a&&a.map((function(e){return Object(u.jsx)(I.a.Row,{children:Object(u.jsx)(B,{todo:e})},e.id)}))})]}):Object(u.jsxs)(i.a,{textAlign:"center",children:[Object(u.jsx)("h1",{style:{marginTop:20,marginBottom:20},children:"Login or Register to use TODO"}),Object(u.jsx)(f.a,{name:"sticky note",size:"massive",color:"grey"})]})})};var Z,_=Object($.a)(X||(X=Object(S.a)(["\n  mutation login($username: String!, $password: String!) {\n    login(username: $username, password: $password) {\n      id\n      email\n      username\n      createdAt\n      token\n    }\n  }\n"]))),ee=function(e,t){t.callback;var n=Object(o.useContext)(O),r=Object(o.useState)({}),a=Object(l.a)(r,2),s=a[0],c=a[1],i=V((function(){h()}),{username:"",password:""}),d=i.onChange,j=i.onSubmit,b=i.values,m=Object(C.useMutation)(_,{update:function(t,r){var a=r.data.login;n.login(a),window.location.reload().then((function(){return e.history.push("/")}))},onError:function(e){e.graphQLErrors[0].extensions.exception.errors&&c(e.graphQLErrors[0].extensions.exception.errors)},variables:b}),g=Object(l.a)(m,2),h=g[0],p=g[1].loading;return Object(u.jsxs)("div",{className:"form-container",children:[Object(u.jsxs)(H.a,{onSubmit:j,noValidate:!0,className:p?"loading":"",children:[Object(u.jsx)("h1",{children:"Login"}),Object(u.jsx)(H.a.Input,{label:"Username",placeholder:"Username..",name:"username",type:"text",value:b.username,error:!!s.username,onChange:d}),Object(u.jsx)(H.a.Input,{label:"Password",placeholder:"Password..",name:"password",type:"password",value:b.password,error:!!s.password,onChange:d}),Object(u.jsx)(Q.a,{type:"submit",primary:!0,children:"Login"})]}),Object.keys(s).length>0&&Object(u.jsx)("div",{className:"ui error message",children:Object(u.jsx)("ul",{className:"list",children:Object.values(s).map((function(e){return Object(u.jsx)("li",{children:e},e)}))})})]})};var te=Object($.a)(Z||(Z=Object(S.a)(["\n  mutation register(\n    $username: String!\n    $email: String!\n    $password: String!\n    $confirmPassword: String!\n  ) {\n    register(\n      registerInput: {\n        username: $username\n        email: $email\n        password: $password\n        confirmPassword: $confirmPassword\n      }\n    ) {\n      id\n      email\n      username\n      createdAt\n      token\n    }\n  }\n"]))),ne=function(e){var t=Object(o.useContext)(O),n=Object(o.useState)({}),r=Object(l.a)(n,2),a=r[0],s=r[1],c=V((function(){g()}),{username:"",email:"",password:"",confirmPassword:""}),i=c.onChange,d=c.onSubmit,j=c.values,b=Object(C.useMutation)(te,{update:function(n,r){var a=r.data.register;t.login(a),window.location.reload().then((function(){return e.history.push("/")}))},onError:function(e){e.graphQLErrors[0].extensions.exception.errors&&s(e.graphQLErrors[0].extensions.exception.errors)},variables:j}),m=Object(l.a)(b,2),g=m[0],h=m[1].loading;return Object(u.jsxs)("div",{className:"form-container",children:[Object(u.jsxs)(H.a,{onSubmit:d,noValidate:!0,className:h?"loading":"",children:[Object(u.jsx)("h1",{children:"Register"}),Object(u.jsx)(H.a.Input,{label:"Username",placeholder:"Username..",name:"username",type:"text",value:j.username,error:!!a.username,onChange:i}),Object(u.jsx)(H.a.Input,{label:"Email",placeholder:"Email..",name:"email",type:"email",value:j.email,error:!!a.email,onChange:i}),Object(u.jsx)(H.a.Input,{label:"Password",placeholder:"Password..",name:"password",type:"password",value:j.password,error:!!a.password,onChange:i}),Object(u.jsx)(H.a.Input,{label:"Confirm Password",placeholder:"Confirm Password..",name:"confirmPassword",type:"password",value:j.confirmPassword,error:!!a.confirmPassword,onChange:i}),Object(u.jsx)(Q.a,{type:"submit",primary:!0,children:"Register"})]}),Object.keys(a).length>0&&Object(u.jsx)("div",{className:"ui error message",children:Object(u.jsx)("ul",{className:"list",children:Object.values(a).map((function(e){return Object(u.jsx)("li",{children:e},e)}))})})]})};var re=function(){return Object(u.jsx)(h,{children:Object(u.jsx)(s.a,{hashType:"noslash",children:Object(u.jsxs)(i.a,{children:[Object(u.jsx)(w,{}),Object(u.jsx)(c.b,{Route:!0,exact:!0,path:"/",component:Y}),Object(u.jsx)(x,{exact:!0,path:"/login",component:ee}),Object(u.jsx)(x,{exact:!0,path:"/register",component:ne})]})})})},ae=n(207),oe=Object(C.createHttpLink)({uri:"https://todoadd.herokuapp.com/"}),se=Object(ae.a)((function(){var e=localStorage.getItem("jwtToken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}})),ce=new C.ApolloClient({link:se.concat(oe),cache:new C.InMemoryCache}),ie=Object(u.jsx)(C.ApolloProvider,{client:ce,children:Object(u.jsx)(re,{})});a.a.render(ie,document.getElementById("root"))}},[[234,1,2]]]);
//# sourceMappingURL=main.422e7175.chunk.js.map